-- –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
DROP TABLE IF EXISTS recipes CASCADE;

-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤
CREATE TABLE recipes (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    name TEXT NOT NULL,
    oils JSONB NOT NULL,
    effect TEXT,
    mood TEXT[] DEFAULT '{}',
    time_of_day TEXT[] DEFAULT '{}',
    benefits TEXT[] DEFAULT '{}',
    category TEXT DEFAULT '–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ',
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –í–∫–ª—é—á–∞–µ–º Row Level Security
ALTER TABLE recipes ENABLE ROW LEVEL SECURITY;

-- –°–æ–∑–¥–∞–µ–º –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è —á—Ç–µ–Ω–∏—è –≤—Å–µ–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
CREATE POLICY "Anyone can view recipes"
ON recipes FOR SELECT
TO authenticated
USING (true);

-- –°–æ–∑–¥–∞–µ–º –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –≤ –±—É–¥—É—â–µ–º)
CREATE POLICY "Only admins can modify recipes"
ON recipes
USING (auth.uid() IN (SELECT user_id FROM admin_users))
WITH CHECK (auth.uid() IN (SELECT user_id FROM admin_users));

-- –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX recipes_category_idx ON recipes(category);
CREATE INDEX recipes_created_at_idx ON recipes(created_at DESC);
CREATE INDEX recipes_mood_idx ON recipes USING GIN (mood);
CREATE INDEX recipes_time_of_day_idx ON recipes USING GIN (time_of_day);

-- –°–æ–∑–¥–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
CREATE OR REPLACE FUNCTION update_recipes_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_recipes_updated_at
    BEFORE UPDATE ON recipes
    FOR EACH ROW
    EXECUTE FUNCTION update_recipes_updated_at();

-- –í—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
INSERT INTO recipes (name, oils, effect, mood, time_of_day, benefits, category) VALUES
-- –£—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã
(
  '–≠–Ω–µ—Ä–≥–∏—è —Ä–∞—Å—Å–≤–µ—Ç–∞',
  '[{"name":"–õ–∏–º–æ–Ω","amount":3,"color":"#FFD700","description":"–û—Å–≤–µ–∂–∞—é—â–∏–π —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üçã"},{"name":"–†–æ–∑–º–∞—Ä–∏–Ω","amount":2,"color":"#90EE90","description":"–¢—Ä–∞–≤—è–Ω–æ–π, –±–æ–¥—Ä—è—â–∏–π –∞—Ä–æ–º–∞—Ç","icon":"üåø"},{"name":"–ú—è—Ç–∞","amount":1,"color":"#98FF98","description":"–°–≤–µ–∂–∏–π, –ø—Ä–æ—Ö–ª–∞–¥–Ω—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üå±"}]'::jsonb,
  '–ë–æ–¥—Ä—è—â–∏–π –∞—Ä–æ–º–∞—Ç –¥–ª—è —ç–Ω–µ—Ä–≥–∏—á–Ω–æ–≥–æ –Ω–∞—á–∞–ª–∞ –¥–Ω—è',
  ARRAY['–±–æ–¥—Ä–æ—Å—Ç—å', '—ç–Ω–µ—Ä–≥–∏—è', '–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è'],
  ARRAY['morning'],
  ARRAY['—Ç–æ–Ω–∏–∑–∏—Ä—É—é—â–∏–π', '–æ—Å–≤–µ–∂–∞—é—â–∏–π', '—Å—Ç–∏–º—É–ª–∏—Ä—É—é—â–∏–π'],
  '–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ'
),
(
  '–£—Ç—Ä–µ–Ω–Ω—è—è –º–µ–¥–∏—Ç–∞—Ü–∏—è',
  '[{"name":"–õ–∞–≤–∞–Ω–¥–∞","amount":2,"color":"#E6E6FA","description":"–£—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üíú"},{"name":"–ë–µ—Ä–≥–∞–º–æ—Ç","amount":2,"color":"#98FB98","description":"–¶–∏—Ç—Ä—É—Å–æ–≤—ã–π, –æ—Å–≤–µ–∂–∞—é—â–∏–π –∞—Ä–æ–º–∞—Ç","icon":"üçä"}]'::jsonb,
  '–ì–∞—Ä–º–æ–Ω–∏—á–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –¥–ª—è —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ —É—Ç—Ä–∞',
  ARRAY['—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ', '–≥–∞—Ä–º–æ–Ω–∏—è'],
  ARRAY['morning'],
  ARRAY['—É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π', '–±–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–∏–π'],
  '–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ'
),

-- –î–Ω–µ–≤–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
(
  '–†–∞–±–æ—á–∏–π –Ω–∞—Å—Ç—Ä–æ–π',
  '[{"name":"–†–æ–∑–º–∞—Ä–∏–Ω","amount":2,"color":"#90EE90","description":"–¢—Ä–∞–≤—è–Ω–æ–π, –±–æ–¥—Ä—è—â–∏–π –∞—Ä–æ–º–∞—Ç","icon":"üåø"},{"name":"–õ–∏–º–æ–Ω","amount":2,"color":"#FFD700","description":"–û—Å–≤–µ–∂–∞—é—â–∏–π —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üçã"},{"name":"–ë–∞–∑–∏–ª–∏–∫","amount":1,"color":"#32CD32","description":"–ü—Ä—è–Ω—ã–π, –æ—Å–≤–µ–∂–∞—é—â–∏–π –∞—Ä–æ–º–∞—Ç","icon":"üåø"}]'::jsonb,
  '–ü–æ–≤—ã—à–∞–µ—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å',
  ARRAY['–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è', '–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'],
  ARRAY['afternoon'],
  ARRAY['—Å—Ç–∏–º—É–ª–∏—Ä—É—é—â–∏–π', '—Ç–æ–Ω–∏–∑–∏—Ä—É—é—â–∏–π'],
  '–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ'
),
(
  '–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–ª–µ—Ç',
  '[{"name":"–ë–µ—Ä–≥–∞–º–æ—Ç","amount":2,"color":"#98FB98","description":"–¶–∏—Ç—Ä—É—Å–æ–≤—ã–π, –æ—Å–≤–µ–∂–∞—é—â–∏–π –∞—Ä–æ–º–∞—Ç","icon":"üçä"},{"name":"–ò–ª–∞–Ω–≥-–∏–ª–∞–Ω–≥","amount":1,"color":"#DDA0DD","description":"–≠–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üå∫"}]'::jsonb,
  '–í–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π –∞—Ä–æ–º–∞—Ç –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã',
  ARRAY['–≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ', '—Ä–∞–¥–æ—Å—Ç—å'],
  ARRAY['afternoon'],
  ARRAY['–≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π', '–ø–æ–¥–Ω–∏–º–∞—é—â–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ'],
  '–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ'
),

-- –í–µ—á–µ—Ä–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã
(
  '–í–µ—á–µ—Ä–Ω—è—è –≥–∞—Ä–º–æ–Ω–∏—è',
  '[{"name":"–õ–∞–≤–∞–Ω–¥–∞","amount":2,"color":"#E6E6FA","description":"–£—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üíú"},{"name":"–†–æ–º–∞—à–∫–∞","amount":2,"color":"#FFFF00","description":"–ù–µ–∂–Ω—ã–π —Ç—Ä–∞–≤—è–Ω–æ–π –∞—Ä–æ–º–∞—Ç","icon":"üåº"}]'::jsonb,
  '–ü–æ–º–æ–≥–∞–µ—Ç —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è',
  ARRAY['—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ', '—Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ'],
  ARRAY['evening'],
  ARRAY['—Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–π', '—É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π'],
  '–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ'
),
(
  '–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä',
  '[{"name":"–ò–ª–∞–Ω–≥-–∏–ª–∞–Ω–≥","amount":2,"color":"#DDA0DD","description":"–≠–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üå∫"},{"name":"–ñ–∞—Å–º–∏–Ω","amount":1,"color":"#FFF0F5","description":"–ß—É–≤—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üå∏"},{"name":"–†–æ–∑–∞","amount":1,"color":"#FF69B4","description":"–ì–ª—É–±–æ–∫–∏–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üåπ"}]'::jsonb,
  '–°–æ–∑–¥–∞–µ—Ç —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É',
  ARRAY['—Ä–æ–º–∞–Ω—Ç–∏–∫–∞', '—á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å'],
  ARRAY['evening'],
  ARRAY['—á—É–≤—Å—Ç–≤–µ–Ω–Ω—ã–π', '–≥–∞—Ä–º–æ–Ω–∏–∑–∏—Ä—É—é—â–∏–π'],
  '–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ'
),

-- –ù–æ—á–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
(
  '–°–ª–∞–¥–∫–∏–µ —Å–Ω—ã',
  '[{"name":"–õ–∞–≤–∞–Ω–¥–∞","amount":3,"color":"#E6E6FA","description":"–£—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π —Ü–≤–µ—Ç–æ—á–Ω—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üíú"},{"name":"–†–æ–º–∞—à–∫–∞","amount":2,"color":"#FFFF00","description":"–ù–µ–∂–Ω—ã–π —Ç—Ä–∞–≤—è–Ω–æ–π –∞—Ä–æ–º–∞—Ç","icon":"üåº"},{"name":"–í–∞–Ω–∏–ª—å","amount":1,"color":"#F5DEB3","description":"–¢–µ–ø–ª—ã–π, —Å–ª–∞–¥–∫–∏–π –∞—Ä–æ–º–∞—Ç","icon":"üç∂"}]'::jsonb,
  '–°–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –≥–ª—É–±–æ–∫–æ–º—É –∏ —Å–ø–æ–∫–æ–π–Ω–æ–º—É —Å–Ω—É',
  ARRAY['—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ', '—É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ'],
  ARRAY['night'],
  ARRAY['—É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π', '—Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–π'],
  '–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ'
),
(
  '–ù–æ—á–Ω–∞—è –º–µ–¥–∏—Ç–∞—Ü–∏—è',
  '[{"name":"–°–∞–Ω–¥–∞–ª","amount":2,"color":"#DEB887","description":"–î—Ä–µ–≤–µ—Å–Ω—ã–π, –∑–µ–º–ª–∏—Å—Ç—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üå≥"},{"name":"–õ–∞–¥–∞–Ω","amount":2,"color":"#CD853F","description":"–ì–ª—É–±–æ–∫–∏–π, –¥—É—Ö–æ–≤–Ω—ã–π –∞—Ä–æ–º–∞—Ç","icon":"‚ú®"}]'::jsonb,
  '–ü–æ–º–æ–≥–∞–µ—Ç –¥–æ—Å—Ç–∏—á—å –≥–ª—É–±–æ–∫–æ–π –º–µ–¥–∏—Ç–∞—Ü–∏–∏',
  ARRAY['–º–µ–¥–∏—Ç–∞—Ü–∏—è', '–¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å'],
  ARRAY['night'],
  ARRAY['–º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–π', '–∑–∞–∑–µ–º–ª—è—é—â–∏–π'],
  '–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ'
),

-- –†–µ—Ü–µ–ø—Ç—ã –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é
(
  '–¶–∏—Ç—Ä—É—Å–æ–≤–∞—è —Ä–∞–¥–æ—Å—Ç—å',
  '[{"name":"–ê–ø–µ–ª—å—Å–∏–Ω","amount":3,"color":"#FFA500","description":"–°–ª–∞–¥–∫–∏–π —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üçä"},{"name":"–ì—Ä–µ–π–ø—Ñ—Ä—É—Ç","amount":2,"color":"#FF6347","description":"–°–≤–µ–∂–∏–π —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üçä"},{"name":"–õ–∏–º–æ–Ω","amount":1,"color":"#FFD700","description":"–û—Å–≤–µ–∂–∞—é—â–∏–π —Ü–∏—Ç—Ä—É—Å–æ–≤—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üçã"}]'::jsonb,
  '–ü–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –∑–∞—Ä—è–∂–∞–µ—Ç –ø–æ–∑–∏—Ç–∏–≤–æ–º',
  ARRAY['—Ä–∞–¥–æ—Å—Ç—å', '–±–æ–¥—Ä–æ—Å—Ç—å'],
  ARRAY['morning', 'afternoon'],
  ARRAY['–∞–Ω—Ç–∏–¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω—ã–π', '—Ç–æ–Ω–∏–∑–∏—Ä—É—é—â–∏–π'],
  '–ü–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é'
),
(
  '–õ–µ—Å–Ω–æ–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ',
  '[{"name":"–ö–µ–¥—Ä","amount":2,"color":"#8B4513","description":"–î—Ä–µ–≤–µ—Å–Ω—ã–π, –∑–µ–º–ª–∏—Å—Ç—ã–π –∞—Ä–æ–º–∞—Ç","icon":"üå≤"},{"name":"–ü–∏—Ö—Ç–∞","amount":2,"color":"#228B22","description":"–•–≤–æ–π–Ω—ã–π, —Å–≤–µ–∂–∏–π –∞—Ä–æ–º–∞—Ç","icon":"üå≤"},{"name":"–ú–æ–∂–∂–µ–≤–µ–ª—å–Ω–∏–∫","amount":1,"color":"#006400","description":"–¢–µ—Ä–ø–∫–∏–π, –ª–µ—Å–Ω–æ–π –∞—Ä–æ–º–∞—Ç","icon":"üåø"}]'::jsonb,
  '–°–æ–∑–¥–∞–µ—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –ª–µ—Å–∞ –∏ —É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏—è',
  ARRAY['—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ', '–≥–∞—Ä–º–æ–Ω–∏—è'],
  ARRAY['afternoon', 'evening'],
  ARRAY['—É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–π', '–∑–∞–∑–µ–º–ª—è—é—â–∏–π'],
  '–ü–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é'
); 